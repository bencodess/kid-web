<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>stilleswasser93 ID</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;}
html,body{width:100%;height:100%;font-family:'Roboto',sans-serif;overflow:hidden;display:flex;justify-content:center;align-items:center;background:#000;color:#fff;}
#bg-video{position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;opacity:0.25;}
.card{background:rgba(0,0,0,0.8);border:2px solid #fff;border-radius:20px;padding:2rem;width:400px;text-align:center;box-shadow:0 0 40px rgba(255,255,255,0.5);transition:0.3s;}
.card:hover{transform:scale(1.05);box-shadow:0 0 60px rgba(255,255,255,0.7);}
.avatar{width:120px;height:120px;border-radius:50%;border:4px solid #fff;margin-bottom:0.5rem;box-shadow:0 0 20px rgba(255,255,255,0.5);}
h1{margin-bottom:0.2rem;font-size:1.8rem;text-shadow:0 0 10px #fff;}
.status{margin:0.5rem 0;font-weight:bold;font-size:1rem;}
.status-dot{height:14px;width:14px;border-radius:50%;display:inline-block;margin-right:0.5rem;box-shadow:0 0 10px #fff;}
.online{background:#43b581;}
.idle{background:#faa61a;}
.dnd{background:#f04747;}
.offline{background:#747f8d;}
.primary-guild{margin-bottom:0.7rem;display:flex;align-items:center;justify-content:center;gap:5px;font-size:0.85rem;color:#1db954;text-shadow:0 0 5px #1db954;}
.primary-guild img{width:18px;height:18px;}
.activities{margin-top:1rem;display:flex;flex-direction:column;gap:8px;justify-content:center;align-items:center;font-size:0.95rem;}
.activity-item, .spotify-item{display:flex;align-items:center;gap:8px;}
.spotify-item{color:#1db954;text-shadow:0 0 5px #1db954;}
.spotify-item img, .activity-item img{width:40px;height:40px;border-radius:5px;transition:0.5s;}
.spotify-item img{animation:glow 2s infinite alternate;}
@keyframes glow{0%{opacity:0.7;}50%{opacity:1;}100%{opacity:0.7;}}
.activity-item{color:#00d4ff;text-shadow:0 0 5px #00d4ff;}
.footer-glow{position:fixed;bottom:20px;font-size:0.8rem;color:#fff;text-shadow:0 0 10px #fff;}
#visit-counter{position:fixed;bottom:10px;left:10px;font-size:0.8rem;color:#fff;text-shadow:0 0 5px #fff;display:none;}
</style>
</head>
<body>

<video autoplay muted loop id="bg-video">
  <source src="/assets/background.mp4" type="video/mp4">
  Your browser does not support HTML5 video.
</video>

<div class="card">
  <img src="" alt="Avatar" class="avatar" id="avatar">
  <h1 id="username">stilleswasser93</h1>
  <div class="status"><span class="status-dot" id="status-dot"></span><span id="status-text"></span></div>
  <div class="primary-guild" id="primary-guild"></div>
  <div class="activities" id="activities"></div>
</div>

<div class="footer-glow">Made by ben.dev</div>
<div id="visit-counter">Visits: 0</div>

<script>
const userId = "1033745912071192688";
const showCounter = true;

const avatarImg = document.getElementById("avatar");
const usernameEl = document.getElementById("username");
const statusDot = document.getElementById("status-dot");
const statusText = document.getElementById("status-text");
const activitiesContainer = document.getElementById("activities");
const primaryGuildEl = document.getElementById("primary-guild");
const counterEl = document.getElementById("visit-counter");

// ========== Visit Counter ==========
if(showCounter){
  counterEl.style.display='block';
  let visits = localStorage.getItem('visits')||0;
  visits=parseInt(visits)+1;
  localStorage.setItem('visits',visits);
  counterEl.textContent=`Visits: ${visits}`;
}

// ========== Card Update ==========
function updateActivities(data){
  activitiesContainer.innerHTML='';

  // Spotify einmalig
  if(data.listening_to_spotify){
    const spotifyDiv = document.createElement('div');
    spotifyDiv.className='spotify-item';
    
    const cover = document.createElement('img');
    cover.src = data.spotify.album_art_url;
    cover.alt = 'Spotify Cover';

    const text = document.createElement('span');
    text.textContent = `${data.spotify.song} - ${data.spotify.artist}`;

    spotifyDiv.appendChild(cover);
    spotifyDiv.appendChild(text);
    activitiesContainer.appendChild(spotifyDiv);
  }

  // Andere Activities
  if(data.activities){
    data.activities.forEach(act=>{
      if(act.type !== 2){ // Spotify schon angezeigt
        const div = document.createElement('div');
        div.className = 'activity-item';

        if(act.assets && act.assets.large_image){
          let imgUrl = act.assets.large_image;
          if(imgUrl.startsWith('mp:external/')){
            imgUrl = imgUrl.split('/https/')[1];
            imgUrl = 'https://' + imgUrl;
          } else {
            imgUrl = `https://cdn.discordapp.com/app-assets/${act.application_id}/${imgUrl}.png`;
          }
          const img = document.createElement('img');
          img.src = imgUrl;
          div.appendChild(img);
        }

        const span = document.createElement('span');
        span.textContent = act.name + (act.details ? `: ${act.details}` : '');
        div.appendChild(span);

        activitiesContainer.appendChild(div);
      }
    });
  }
}

// Primary Guild + Badge
function updateGuild(data){
  primaryGuildEl.innerHTML = '';
  if(data.primary_guild && data.primary_guild.tag){
    const img = document.createElement('img');
    if(data.primary_guild.badge){
      img.src = `https://cdn.discordapp.com/badges/${data.primary_guild.badge}.png`;
    }
    const span = document.createElement('span');
    span.textContent = data.primary_guild.tag;
    primaryGuildEl.appendChild(img);
    primaryGuildEl.appendChild(span);
  }
}

function updateCard(data){
  avatarImg.src = `https://cdn.discordapp.com/avatars/${data.discord_user.id}/${data.discord_user.avatar}.png?size=256`;
  usernameEl.textContent = data.discord_user.username;
  const status = data.discord_status;
  statusDot.className = `status-dot ${status}`;
  statusText.textContent = status.charAt(0).toUpperCase() + status.slice(1);

  updateGuild(data);
  updateActivities(data);
}

// ========== Fetch & WebSocket ==========
async function fetchLanyard(){
  const res = await fetch(`https://api.lanyard.rest/v1/users/${userId}`);
  const data = await res.json();
  updateCard(data.data);
}

fetchLanyard();

const ws = new WebSocket(`wss://api.lanyard.rest/socket`);
ws.onopen = ()=> ws.send(JSON.stringify({op:2,d:{subscribe_to_id:userId}}));
ws.onmessage = (msg)=>{
  const data = JSON.parse(msg.data);
  if(data.t==="INIT_STATE"||data.t==="PRESENCE_UPDATE"){
    updateCard(data.d);
  }
};
</script>

</body>
</html>
